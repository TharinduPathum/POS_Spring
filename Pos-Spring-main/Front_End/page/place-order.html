<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Order Management</title>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600&display=swap"
      rel="stylesheet"
    />
    <style>

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #0c1524, #1a2a4a);
        color: #e0e0e0;
        margin: 0;
        padding: 0;
      }

      .mainContainer {
        width: 90%;
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
        background: rgba(12, 21, 36, 0.8);
        border-radius: 24px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(6px);
      }


      h2 {
        text-align: center;
        margin-bottom: 2rem;
        color: #a8c0ff;
      }


      .inputBox {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }

      .inputBox label {
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #c0c0c0;
      }

      .inputBox input,
      .inputBox select {
        padding: 0.5rem 0.8rem;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
        outline: none;
        transition: all 0.3s ease;
      }

      .inputBox input:focus,
      .inputBox select:focus {
        border-color: #4caf50;
        box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
      }


      .inputContainer {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      /* Button Container */
      .buttonContainer {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 1rem;
      }

      .buttonContainer button {
        padding: 0.6rem 1.5rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        color: #fff;
        background: #4caf50; /* default green */
      }

      .buttonContainer button:hover {
        opacity: 0.85;
      }


      #addToCartBtnId {
        background-color: #2196F3;
      }

      .buttonContainer button:nth-child(2) {
        background-color: #f44336;
      }

      .buttonContainer button:nth-child(3) {
        background-color: #FF9800;
      }


      .tableContainer {
        margin-top: 2rem;
        overflow-x: auto;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(12, 21, 36, 0.7);
        border-radius: 12px;
        overflow: hidden;
        backdrop-filter: blur(4px);
      }

      .table th,
      .table td {
        padding: 0.8rem 1rem;
        text-align: left;
        color: #e0e0e0;
      }

      .table th {
        background: rgba(86, 120, 190, 0.4);
      }

      .table tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.05);
      }

      .table tr:hover {
        background: rgba(255, 255, 255, 0.1);
      }


      .buttonContainer i {
        margin-right: 0.5rem;
      }
    </style>
  </head>

  <body>
    <div class="mainContainer">
      <h2>Order Management</h2>

      <div class="inputBox">
        <label>Oder id :</label>
        <input type="text" id="orderId" />
      </div>

      <div class="inputContainer">
        <div class="inputBox">
          <label>Item Id :</label>
          <select id="itemIdSelector">
            <option value="I001">I001</option>
            <option value="I002">I002</option>
            <option value="I003">I003</option>
            <option value="I004">I004</option>
          </select>
        </div>

        <div class="inputBox">
          <label>Customer ID :</label>
          <select id="customerIdSelector">
            <option value="C001">C001</option>
            <option value="C002">C002</option>
            <option value="C003">C003</option>
            <option value="C004">C004</option>
          </select>
        </div>

        <div class="inputBox">
          <label>Item Name :</label>
          <input type="text" id="itemName" />
        </div>

        <div class="inputBox">
          <label>Item Price :</label>
          <input type="number" id="itemPrice" />
        </div>

        <div class="inputBox">
          <label>Qty On Hand :</label>
          <input type="number" id="QtyOnHandId" />
        </div>

        <div class="inputBox">
          <label>totle Price:</label>
          <input type="number" id="totalPrice" />
        </div>
      </div>

      <div class="buttonContainer">
        <button id="addToCartBtnId">Add to cart</button>
        <button onclick="refresh()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>

      <div class="tableContainer">
        <table id="tableId" class="table">
          <thead>
            <tr>
              <!-- <th scope="col">#</th> -->
              <th scope="col">Item Id</th>
              <th scope="col">customer id</th>
              <th scope="col">unit Price</th>
              <th scope="col">Qty</th>
              <th scope="col">Total Price</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tbodyId"></tbody>
        </table>
      </div>

      <div class="buttonContainer">
        <button onclick="PlaceOder()">Place oder</button>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script src="/Assest/lib/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script>
      let cart = [];
      localStorage.setItem("cart", JSON.stringify(cart));

      $("#addToCartBtnId").on("click", () => {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        let data = localStorage.getItem("item");
        // Convert back to object
        let itemObject = JSON.parse(data);

        let likeqty = localStorage.getItem("likEqty");

        console.log("--------------------------------------");
        console.log(itemObject.avelableItemQty);
        console.log(likeqty);
        if (Number(itemObject.avelableItemQty) < Number(likeqty)) {
          Swal.fire({
            title: "Please Enter relevant qty... ",
            text: "",
            icon: "err",
            timer: 2000,
          });
          return;
        }

        const itemId = $("#itemIdSelector").val();
        const customerID = $("#customerIdSelector").val();
        const unitPrice = $("#itemPrice").val();
        const qtys = likeqty;
        const totalPrice = $("#totalPrice").val();
        const oderId = $("#oderId").val();

        // let tr = Document.createElement("tr");
        let row = `<tr style=" cursor: pointer;">
                                    <td>${itemId}</td>
                                    <td>${customerID}</td>
                                    <td>${unitPrice}</td>
                                     <td>${qtys}</td>
                                     <td>${totalPrice}</td>
                                    <td>
                                         <button id="cansalId"  data-itemid="${itemId}" >Cansel</button>
                                         <button  id="editId" data-itemid="${itemId}" >Edit</button>
                          </td>
                                  </tr>`;

        $("#tbodyId").append(row);

        let newItem = {
          oderDeatilesId: "null",
          oderId: oderId,
          itemId: itemId,
          qty: qtys,
          totlePrice: totlePrice,
        };

        cart.push(newItem);

        localStorage.setItem("cart", JSON.stringify(cart));
        clearForm();

      });

      function lodeCustormers() {
        $.ajax({
          url: "http://localhost:8081/api/v1/customer/getAll",
          method: "GET",
          success: function (response) {
            console.log(response);
            $("#tbodyId").empty();

            const custormerId = [];

            for (let i = 0; i < response.length; i++) {
              let customerid = response[i].cId;
              custormerId.push(customerid);
            }

            const select = document.getElementById("customerIdSelector");
            $("#customerIdSelector").empty();
            custormerId.forEach((customerId, index) => {
              const option = document.createElement("option");
              option.value = customerId; // Option value
              option.text = customerId; // Option display text
              select.appendChild(option);
            });
          },
        });
      }

      function Items() {
        $.ajax({
          url: "http://localhost:8081/api/v1/Item/getAll",
          method: "GET",
          success: function (response) {
            const itemIds = [];

            for (let i = 0; i < response.length; i++) {
              let itemId = response[i].itemId;
              itemIds.push(itemId);
            }

            const select = document.getElementById("itemIdSelector");
            $("#itemIdSelector").empty();
            itemIds.forEach((itemIds, index) => {
              const option = document.createElement("option");
              option.value = itemIds; //  value
              option.text = itemIds; // text
              select.appendChild(option);
            });
          },
        });
      }

      $("#custormerIdSelector").on("change", function () {
        const selectedValue = $(this).val(); // select values
        console.log("Selected customer ID:", selectedValue);
      });

      $("#itemIdSelector").on("change", function () {
        const selectedValue = $(this).val(); // select value
        console.log("Selected Item ID:", selectedValue);

        $.ajax({
          url: "http://localhost:8081/api/v1/Item/getAll",
          method: "GET",
          success: function (response) {

            for (let i = 0; i < response.length; i++) {
              let itemId = response[i].itemId;
              if (itemId == selectedValue) {
                let item = {
                  id: response[i].itemId,
                  itemName: response[i].itemName,
                  itemPrice: response[i].price,
                  avelableItemQty: response[i].qty,
                };

                localStorage.setItem("item", JSON.stringify(item));

                const itemid = response[i].itemId;
                const nasme = response[i].itemName;
                const qty = response[i].qty;
                const prices = response[i].price;
                $("#itemName").val(nasme);
                $("#itemPrice").val(prices);
                $("#availableItemQty").val(qty);
              }
            }
          },
        });
      });


      $("#QtyOnHandId").on("input", function () {
        console.log("Typing:", $(this).val());
        localStorage.setItem("likEqty", $(this).val());

        let data = localStorage.getItem("item");
        // Convert back to object
        let itemObject = JSON.parse(data);

        const CustormerLikeqty = $(this).val();
        const itemPrice = itemObject.itemPrice;

        const totlePrice = CustormerLikeqty * itemPrice;

        $("#totlePrice").val(totlePrice);
      });

      function clearForm() {
        $("#itemName").val("");
        $("#itemPrice").val("");
        $("#availableItemQty").val("");
        $("#QtyOnHandId").val("");
        $("#totalPrice").val("");
      }

      function PlaceOder() {
        const itemId = $("#itemIdSelector").val();
        const customerID = $("#customerIdSelector").val();
        const unitPrice = $("#itemPrice").val();
        // const qtys = likeqty;
        const totalPrice = $("#totalPrice").val();
        const oderId = $("#oderId").val();
        let nowdate = new Date();
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        if (!custormerID || !oderId || cart.length === 0) {
          alert("Please select a item first before purches..");
          return;
        }

        $.ajax({
          url: "http://localhost:8081/api/v1/placeOder/saveOder",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            oderId: oderId,
            custormerId: customerID,
            oderDeatilesList: cart,
            date: nowdate,
          }),
          success: function (respons, textStatus, xhr) {
            if (xhr.status === 201) {
              Swal.fire({
                title: "Successfully Saved",
                text: "",
                icon: "success",
                timer: 2000,
              });
            }
            localStorage.setItem("cart", JSON.stringify([]));

            $("#tbodyId").empty();

            lodeNextId();
            clearForm();
          },
          error: function (respons, textStatus, xhr) {
            Swal.fire({
              title: "Saved UnSuccessfully ! ",
              text: "",
              icon: "success",
              timer: 2000,
            });
          },
        });
      }

      function lodeNextId() {
        $.ajax({
          url: "http://localhost:8081/api/v1/placeOder/getLastOderId",
          method: "GET",
          success: function (respons) {
            const id = respons;
            $("#oderId").val(id);
          },
          error: function (respons) {
            console.log("Internal Serer Error...");
          },
        });
      }

      function refresh() {
        clearForm();
        lodeNextId();
      }

      document.addEventListener("DOMContentLoaded", function () {
        lodeNextId();
        lodeCustormers();
        Items();
      });
    </script>
  </body>
</html>
